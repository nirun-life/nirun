<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
    <record id="careplan_activity_generator_action" model="ir.actions.act_window">
        <field name="name">Generate Activity</field>
        <field name="res_model">ni.careplan.activity.generator</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
    </record>
    <record id="careplan_activity_generator_view_form" model="ir.ui.view">
        <field name="name">careplan.activity.generator.view.form</field>
        <field name="model">ni.careplan.activity.generator</field>
        <field name="arch" type="xml">
            <form>
                <group>
                    <group>
                        <field name="patient_id" />
                        <field name="encounter_id" />
                    </group>
                    <group>
                        <field name="careplan_id" invisible="context.get('default_careplan_id', False)" />
                    </group>
                </group>
                <field
                    name="service_request_ids"
                    domain="[('patient_id', '=', patient_id), ('encounter_id', '=?', encounter_id), ('state', 'in', ['draft', 'active']), ('careplan_activity_id', '=', False)]"
                    options="{'no_create': True,'no_create_edit': True, 'no_open':True}"
                    widget="many2many"
                />
                <footer>
                    <button
                        name="generate_activity"
                        string="Generate"
                        class="oe_highlight"
                        icon="fa-magic"
                        type="object"
                    />
                    <button string="Cancel" class="btn-secondary" special="cancel" />
                </footer>
            </form>
        </field>
    </record>
    <record id="careplan_view_form_inherit_service_request" model="ir.ui.view">
        <field name="name">careplan.view.form.inherit.service.request</field>
        <field name="model">ni.careplan</field>
        <field name="inherit_id" ref="nirun_careplan.careplan_view_form" />
        <field name="arch" type="xml">
            <xpath expr="//form/header" position="inside">
                <button
                    name="%(careplan_activity_generator_action)d"
                    string="Generate"
                    attrs="{'invisible': [('state', 'not in', ['draft', 'active'] )]}"
                    context="{'default_careplan_id': id}"
                    icon="fa-magic"
                    type="action"
                    groups="nirun_careplan.group_manager"
                />
            </xpath>
        </field>
    </record>
</odoo>
