<?xml version="1.0" encoding="UTF-8" ?>
<!--
  ~ Copyright (c) 2022 Piruin P.
  -->
<odoo>
    <record id="demographic_action" model="ir.actions.act_window">
        <field name="name">Demographic</field>
        <field name="res_model">ni.report.demographic</field>
        <field name="view_mode">tree,form</field>
    </record>
    <record id="demographic_action_to_approve" model="ir.actions.act_window">
        <field name="name">Demographic</field>
        <field name="res_model">ni.report.demographic</field>
        <field name="view_mode">tree,form</field>
        <field name="context">{'search_default_draft': 1,  'search_default_my_company': 1}</field>
    </record>
    <record id="demographic_view_search" model="ir.ui.view">
        <field name="name">demographic.view.search</field>
        <field name="model">ni.report.demographic</field>
        <field name="arch" type="xml">
            <search>
                <field name="name" />
                <field name="company_id" />
                <filter name="my_company" string="My Company" domain="[('company_id','=', allowed_company_ids[0])]" />
                <filter
                    name="my_companies"
                    string="My Companies"
                    domain="[('company_id','in', allowed_company_ids)]"
                    groups="base.group_multi_company"
                />
                <separator />
                <filter name="active" string="Published" domain="[('state', '=', 'active')]" />
                <filter name="draft" string="Draft" domain="[('state', '=', 'draft')]" />
                <separator />
                <filter
                    name="this_month"
                    string="This Month"
                    domain="[('period_end','&gt;=',time.strftime('%%Y-%%m-01')), ('period_end','&lt;',(context_today()+relativedelta(months=1)).strftime('%%Y-%%m-01')),]"
                />
                <filter
                    name="last_month"
                    string="Last Month"
                    domain="[('period_end','&gt;=',(context_today()-relativedelta(months=1)).strftime('%%Y-%%m-01')),('period_end','&lt;',time.strftime('%%Y-%%m-01'))]"
                />
                <filter name="period_end" string="Date" date="period_end" default_period="antepenultimate_month" />
                <group>
                    <filter name="groupby_company_id" string="Company" context="{'group_by': 'company_id'}" />
                    <filter name="groupby_date" string="Date" context="{'group_by': 'period_end:month'}" />
                </group>
            </search>
        </field>
    </record>
    <record id="demographic_view_tree" model="ir.ui.view">
        <field name="name">demographic.view.tree</field>
        <field name="model">ni.report.demographic</field>
        <field name="arch" type="xml">
            <tree>
                <field name="company_id" groups="base.group_multi_company" />
                <field name="name" />
                <field name="period_start" widget="daterange" options="{'related_end_date': 'period_end'}" />
                <field name="period_end" widget="daterange" options="{'related_start_date': 'period_start'}" />
                <field name="create_date" optional="hide" />
                <field name="state" />
                <button
                    name="action_confirm"
                    string="Publish"
                    type="object"
                    icon="fa-globe"
                    class="text-success"
                    states="draft"
                />
            </tree>
        </field>
    </record>
    <record id="demographic_view_form" model="ir.ui.view">
        <field name="name">demographic.view.form</field>
        <field name="model">ni.report.demographic</field>
        <field name="arch" type="xml">
            <form>
                <field name="id" invisible="True" />
                <header class="oe_read_only">
                    <button
                        name="action_confirm"
                        string="Publish"
                        attrs="{'invisible': [('state', 'not in', [ 'draft'])]}"
                        class="btn-primary"
                        confirm="Are you sure you want to publish this report?"
                        type="object"
                        groups="nirun_patient.group_manager"
                    />
                    <field name="state" statusbar_visible="draft,active" widget="statusbar" />
                </header>
                <sheet>
                    <div name="button_box" class="oe_button_box" groups="base.group_user">

                    </div>
                    <widget
                        name="web_ribbon"
                        attrs="{'invisible': ['|', ('state', '!=', 'draft'), ('id', '=', False)]}"
                        bg_color="bg-warning"
                        title="Draft"
                    />
                    <widget
                        name="web_ribbon"
                        attrs="{'invisible': [('state', '!=', 'active')]}"
                        bg_color="bg-success"
                        title="Published"
                    />
                    <group>
                        <group>
                            <field name="company_id" groups="base.group_multi_company" />
                            <field
                                name="period_start"
                                widget="daterange"
                                options="{'related_end_date': 'period_end'}"
                            />
                            <field
                                name="period_end"
                                widget="daterange"
                                options="{'related_start_date': 'period_start'}"
                            />
                        </group>
                        <group>
                            <field name="create_date" />
                            <field name="create_uid" />
                        </group>
                    </group>
                    <notebook attrs="{'invisible': [('id', '=', False)]}">
                        <page string="Detail">
                            <field name="line_ids" context="{'default_report_id':id}">
                                <tree editable="bottom">
                                    <field name="report_id" invisible="1" />
                                    <field name="code_id" />
                                    <field name="total" />
                                    <field name="male" />
                                    <field name="female" />
                                    <field name="other" />
                                    <button
                                        name="action_exec_code"
                                        icon="fa-refresh"
                                        string="re-compute"
                                        type="object"
                                    />
                                </tree>
                            </field>
                        </page>
                        <page string="Note">
                            <field name="note" />
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>
</odoo>
